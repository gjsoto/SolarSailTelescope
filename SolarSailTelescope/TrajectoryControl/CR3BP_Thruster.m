function CR3BP_Thruster()

% close all
% clear all

%% Set-Up
mu     = 3.00345988e-06;
coeffs = [ 1, 3-mu, 3-2*mu, -mu, -2*mu, -mu];
g2roots = roots(coeffs);

g2 = real(g2roots(3));
d_L2 = g2 + 1 - mu;

m1 = 1 - mu;
m2 = mu;

%% Boundary Conditions

x0 = [9.999969595766015e-1;
      -1.007824043999068e-3;
      0];
v0 = [7.237761726886938e-2;
      0;
      0];

Lr = 2e-2;
alpha_r = pi/3;
delta_r = pi/6;

Lv = 3e-2;
alpha_v = pi/3;
delta_v = pi/6;

L0 = [Lr*cos(alpha_r);
      Lr*sin(alpha_r)*cos(delta_r);
      Lr*sin(alpha_r)*sin(delta_r);
      Lv*cos(alpha_v);
      Lv*sin(alpha_v)*cos(delta_v);
      Lv*sin(alpha_v)*sin(delta_v)];

% xF = [1.011080356710551;
%       7.419127797265952e-4;
%       3.655679288769010e-3];
% vF = [6.534277927644666e-4;
%       -1.054583863270762e-2;
%       7.362873998458644e-4];

xF = [1.010032673965715;
      0;
      0.000197672600625];
vF = [0.000001016981938;
      0.000000316029267;
      -0.000127232238948];

s0 = [x0;v0;L0];
sF = [xF;vF;L0];
  


%% BVP using Collocation
% setting up bvp
t = [0 90]; %days
t = t*(1/365.25)*2*pi;
solinit.x = t;                         
solinit.y = [s0,sF];
options_bvp = bvpset('Nmax',15000,'RelTol',1e-12,'AbsTol',1e-12,'FJacobian',@fjacobian,'Vectorized','on');

% solving BVP using collocation
sol = bvp5c(@EoM_Primers_T,@bc_2pts,solinit,options_bvp) ; 
s_bvp = sol.y;

disp( 'Initial States ')
disp(s_bvp(:,1) )
disp( 'Final States ')
disp(s_bvp(:,end) )

%% VL
options_int = odeset('RelTol',2.5e-14,'AbsTol',1e-17,'Jacobian',@fjacobian,'Vectorized','on');
[~,s_halo]=ode113(@EoM,[0 pi],[xF;vF],options_int);
s_halo = s_halo.';

figure()
plot3(s_halo(1,:),s_halo(2,:),s_halo(3,:),'linewidth',3)
xlabel('X (AU)')
ylabel('Y (AU)')
zlabel('Z (AU)')


%% plot
figure()
plot3(s_bvp(1,:),s_bvp(2,:),s_bvp(3,:),'linewidth',3)
hold on
plot3(s_halo(1,:),s_halo(2,:),s_halo(3,:),'linewidth',1)
plot3(s_bvp(1,1),s_bvp(2,1),s_bvp(3,1),'s','markersize',10,'linewidth',2)
plot3(s_bvp(1,end),s_bvp(2,end),s_bvp(3,end),'s','markersize',10,'linewidth',2)
xlabel('X (AU)')
ylabel('Y (AU)')
zlabel('Z (AU)')
legend('BVP Result','Halo','Initial Pos','Final Pos')



%% Aux Functions
    function f = EoM_Primers_T(~,s)
       
        x = s(1,:); dx = s(4,:);
        y = s(2,:); dy = s(5,:);
        z = s(3,:); dz = s(6,:);
        
        L1 = s(7,:); L4 = s(10,:);
        L2 = s(8,:); L5 = s(11,:);
        L3 = s(9,:); L6 = s(12,:);

        f = zeros(size(s));

        r1 = sqrt( (mu+x).^2   + y.^2 + z.^2 );
        r2 = sqrt( (1-mu-x).^2 + y.^2 + z.^2 );

        f(1,:) = dx;
        f(2,:) = dy;
        f(3,:) = dz;
        f(4,:) = 2.*dy - L4 + x + ((2.*mu + 2.*x).*(mu - 1))./(2.*((mu + x).^2 + y.^2 + z.^2).^(3./2)) - (mu.*(2.*mu + 2.*x - 2))./(2.*((mu + x - 1).^2 + y.^2 + z.^2).^(3./2));
        f(5,:) = y - 2.*dx - L5 - (mu.*y)./((mu + x - 1).^2 + y.^2 + z.^2).^(3./2) + (y.*(mu - 1))./((mu + x).^2 + y.^2 + z.^2).^(3./2);
        f(6,:) = (z.*(mu - 1))./((mu + x).^2 + y.^2 + z.^2).^(3./2) - (mu.*z)./((mu + x - 1).^2 + y.^2 + z.^2).^(3./2) - L6;
        
        f(7,:)  = -L4.*((mu - 1)./((mu + x).^2 + y.^2 + z.^2).^(3./2) - mu./((mu + x - 1).^2 + y.^2 + z.^2).^(3./2) + (3.*mu.*(2.*mu + 2.*x - 2).^2)./(4.*((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - (3.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*((mu + x).^2 + y.^2 + z.^2).^(5./2)) + 1) - L5.*((3.*mu.*y.*(2.*mu + 2.*x - 2))./(2.*((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - (3.*y.*(2.*mu + 2.*x).*(mu - 1))./(2.*((mu + x).^2 + y.^2 + z.^2).^(5./2))) - L6.*((3.*mu.*z.*(2.*mu + 2.*x - 2))./(2.*((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - (3.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*((mu + x).^2 + y.^2 + z.^2).^(5./2)));                                                                       
        f(8,:)  = L6.*((3.*y.*z.*(mu - 1))./((mu + x).^2 + y.^2 + z.^2).^(5./2) - (3.*mu.*y.*z)./((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - L5.*((mu - 1)./((mu + x).^2 + y.^2 + z.^2).^(3./2) - mu./((mu + x - 1).^2 + y.^2 + z.^2).^(3./2) - (3.*y.^2.*(mu - 1))./((mu + x).^2 + y.^2 + z.^2).^(5./2) + (3.*mu.*y.^2)./((mu + x - 1).^2 + y.^2 + z.^2).^(5./2) + 1) - L4.*((3.*mu.*y.*(2.*mu + 2.*x - 2))./(2.*((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - (3.*y.*(2.*mu + 2.*x).*(mu - 1))./(2.*((mu + x).^2 + y.^2 + z.^2).^(5./2)));
        f(9,:)  = L5.*((3.*y.*z.*(mu - 1))./((mu + x).^2 + y.^2 + z.^2).^(5./2) - (3.*mu.*y.*z)./((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - L6.*((mu - 1)./((mu + x).^2 + y.^2 + z.^2).^(3./2) - mu./((mu + x - 1).^2 + y.^2 + z.^2).^(3./2) - (3.*z.^2.*(mu - 1))./((mu + x).^2 + y.^2 + z.^2).^(5./2) + (3.*mu.*z.^2)./((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - L4.*((3.*mu.*z.*(2.*mu + 2.*x - 2))./(2.*((mu + x - 1).^2 + y.^2 + z.^2).^(5./2)) - (3.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*((mu + x).^2 + y.^2 + z.^2).^(5./2)));
        f(10,:) = 2.*L5 - L1;
        f(11,:) = -L2 - 2.*L4;
        f(12,:) = -L3;

    end

    function res = bc_2pts(sa,sb)
        
        res = [ sa(1) - x0(1);
                sa(2) - x0(2);
                sa(3) - x0(3);
                sa(4) - v0(1); 
                sa(5) - v0(2);
                sa(6) - v0(3);
                sb(1) - xF(1);
                sb(2) - xF(2);
                sb(3) - xF(3);
                sb(4) - vF(1); 
                sb(5) - vF(2);
                sb(6) - vF(3);];
        
    end

    function f = EoM(~,s)
       
        x = s(1,:); dx = s(4,:);
        y = s(2,:); dy = s(5,:);
        z = s(3,:); dz = s(6,:);

        f = zeros(size(s));

        r1 = sqrt( (mu+x).^2   + y.^2 + z.^2 );
        r2 = sqrt( (1-mu-x).^2 + y.^2 + z.^2 );

        f(1,:) = dx;
        f(2,:) = dy;
        f(3,:) = dz;
        f(4,:) = x + 2.*dy + m1.*(-mu-x)./r1.^3 + m2.*(1-mu-x)./r2.^3;
        f(5,:) = y - 2.*dx + m1.*y./r1.^3 + m2.*y./r2.^3;
        f(6,:) = -m1.*z./r1.^3 - m2.*z./r2.^3;
        
    end

    function [dfdy,dfdp] = fjacobian_T(~,s,T)

        x = s(1,:); dx = s(4,:);
        y = s(2,:); dy = s(5,:);
        z = s(3,:); dz = s(6,:);


        Ux=x+(-1).*mu.*((-1)+mu+x).*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+(-1).* ...
          (1+(-1).*mu).*(mu+x).*((mu+x).^2+y.^2+z.^2).^(-3/2);

        Uy=y+(-1).*mu.*y.*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+(-1).*(1+(-1).* ...
          mu).*y.*((mu+x).^2+y.^2+z.^2).^(-3/2);


        Uz=(-1).*mu.*z.*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+(-1).*(1+(-1).*mu) ...
          .*z.*((mu+x).^2+y.^2+z.^2).^(-3/2);


        dfdp = [ dx;
            dy;
            dz;
            +2*dy + Ux;
            -2*dx + Uy;
            Uz];

        Uxx=1+3.*mu.*((-1)+mu+x).^2.*(((-1)+mu+x).^2+y.^2+z.^2).^(-5/2)+(-1).* ...
          mu.*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+3.*(1+(-1).*mu).*(mu+x) ...
          .^2.*((mu+x).^2+y.^2+z.^2).^(-5/2)+(-1).*(1+(-1).*mu).*((mu+x).^2+ ...
          y.^2+z.^2).^(-3/2);


        Uxy=3.*mu.*((-1)+mu+x).*y.*(((-1)+mu+x).^2+y.^2+z.^2).^(-5/2)+3.*(1+( ...
          -1).*mu).*(mu+x).*y.*((mu+x).^2+y.^2+z.^2).^(-5/2);


        Uxz=3.*mu.*((-1)+mu+x).*z.*(((-1)+mu+x).^2+y.^2+z.^2).^(-5/2)+3.*(1+( ...
          -1).*mu).*(mu+x).*z.*((mu+x).^2+y.^2+z.^2).^(-5/2);


        Uyy=1+3.*mu.*y.^2.*(((-1)+mu+x).^2+y.^2+z.^2).^(-5/2)+(-1).*mu.*(((-1) ...
          +mu+x).^2+y.^2+z.^2).^(-3/2)+3.*(1+(-1).*mu).*y.^2.*((mu+x).^2+ ...
          y.^2+z.^2).^(-5/2)+(-1).*(1+(-1).*mu).*((mu+x).^2+y.^2+z.^2).^( ...
          -3/2);


        Uyz=3.*mu.*y.*z.*(((-1)+mu+x).^2+y.^2+z.^2).^(-5/2)+3.*(1+(-1).*mu).* ...
          y.*z.*((mu+x).^2+y.^2+z.^2).^(-5/2);


        Uzz=3.*mu.*z.^2.*(((-1)+mu+x).^2+y.^2+z.^2).^(-5/2)+(-1).*mu.*(((-1)+ ...
          mu+x).^2+y.^2+z.^2).^(-3/2)+3.*(1+(-1).*mu).*z.^2.*((mu+x).^2+ ...
          y.^2+z.^2).^(-5/2)+(-1).*(1+(-1).*mu).*((mu+x).^2+y.^2+z.^2).^( ...
          -3/2);


        dfdy = T*[ zeros(3) , eye(3); [ Uxx, Uxy, Uxz; Uxy, Uyy, Uyz;Uxz, Uyz, Uzz] , [ 0 , 2, 0; -2, 0, 0; 0,0,0]];
    end


    function [dfdy,dfdp] = fjacobian(~,s)
        
        x = s(1,:); dx = s(4,:);
        y = s(2,:); dy = s(5,:);
        z = s(3,:); dz = s(6,:);
        
        L1 = s(7,:); L4 = s(10,:);
        L2 = s(8,:); L5 = s(11,:);
        L3 = s(9,:); L6 = s(12,:);
        
        r1 = sqrt( (mu+x).^2   + y.^2 + z.^2 );
        r2 = sqrt( (1-mu-x).^2 + y.^2 + z.^2 );


        Ux=x+(-1).*mu.*((-1)+mu+x).*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+(-1).* ...
          (1+(-1).*mu).*(mu+x).*((mu+x).^2+y.^2+z.^2).^(-3/2);

        Uy=y+(-1).*mu.*y.*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+(-1).*(1+(-1).* ...
          mu).*y.*((mu+x).^2+y.^2+z.^2).^(-3/2);


        Uz=(-1).*mu.*z.*(((-1)+mu+x).^2+y.^2+z.^2).^(-3/2)+(-1).*(1+(-1).*mu) ...
          .*z.*((mu+x).^2+y.^2+z.^2).^(-3/2);


        dfdp = [ dx;
            dy;
            dz;
            +2*dy + Ux;
            -2*dx + Uy;
            Uz];
        
        dfdy = [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,  1, 0, 0,  0,  0,  0,                                                                                                                                                                                                                       0,                                                                                                                                                                                     0,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,  0, 1, 0,  0,  0,  0,                                                                                                                                                                                                                       0,                                                                                                                                                                                     0,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,  0, 0, 1,  0,  0,  0,                                                                                                                                                                                                                       0,                                                                                                                                                                                     0,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (mu - 1)./r1.^3 - mu./r2.^3 + (3.*mu.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^5) - (3.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^5) + 1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (3.*mu.*y.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (3.*y.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (3.*mu.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (3.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5),  0, 2, 0,  0,  0,  0,                                                                                                                                                                                                                      -1,                                                                                                                                                                                     0,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (3.*mu.*y.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (3.*y.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (mu - 1)./r1.^3 - mu./r2.^3 - (3.*y.^2.*(mu - 1))./r1.^5 + (3.*mu.*y.^2)./r2.^5 + 1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (3.*mu.*y.*z)./r2.^5 - (3.*y.*z.*(mu - 1))./r1.^5, -2, 0, 0,  0,  0,  0,                                                                                                                                                                                                                       0,                                                                                                                                                                                    -1,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (3.*mu.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (3.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (3.*mu.*y.*z)./r2.^5 - (3.*y.*z.*(mu - 1))./r1.^5,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (mu - 1)./r1.^3 - mu./r2.^3 - (3.*z.^2.*(mu - 1))./r1.^5 + (3.*mu.*z.^2)./r2.^5,  0, 0, 0,  0,  0,  0,                                                                                                                                                                                                                       0,                                                                                                                                                                                     0,                                                                                                                                                                                -1;
 L4.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) + (3.*(8.*mu + 8.*x).*(mu - 1))./(4.*r1.^5) + (15.*mu.*(2.*mu + 2.*x - 2).^3)./(8.*r2.^7) - (15.*(2.*mu + 2.*x).^3.*(mu - 1))./(8.*r1.^7) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (3.*mu.*(8.*mu + 8.*x - 8))./(4.*r2.^5)) - L6.*((3.*mu.*z)./r2.^5 - (3.*z.*(mu - 1))./r1.^5 + (15.*z.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^7) - (15.*mu.*z.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^7)) - L5.*((3.*mu.*y)./r2.^5 - (3.*y.*(mu - 1))./r1.^5 + (15.*y.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^7) - (15.*mu.*y.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^7)),                       L5.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (15.*y.^2.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) + (15.*mu.*y.^2.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L6.*((15.*y.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) - (15.*mu.*y.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L4.*((3.*mu.*y)./r2.^5 - (3.*y.*(mu - 1))./r1.^5 + (15.*y.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^7) - (15.*mu.*y.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^7)),                       L6.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (15.*z.^2.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) + (15.*mu.*z.^2.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L4.*((3.*mu.*z)./r2.^5 - (3.*z.*(mu - 1))./r1.^5 + (15.*z.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^7) - (15.*mu.*z.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^7)) - L5.*((15.*y.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) - (15.*mu.*y.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^7)),  0, 0, 0,  0,  0,  0, mu./r2.^3 - (mu - 1)./r1.^3 - (3.*mu.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^5) + (3.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^5) - 1,                                                     (3.*y.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*y.*(2.*mu + 2.*x - 2))./(2.*r2.^5),                                                 (3.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^5);
                                                                                                                                                                                                                           L5.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (15.*y.^2.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) + (15.*mu.*y.^2.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L6.*((15.*y.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) - (15.*mu.*y.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L4.*((3.*mu.*y)./r2.^5 - (3.*y.*(mu - 1))./r1.^5 + (15.*y.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^7) - (15.*mu.*y.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^7)), L4.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (15.*y.^2.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) + (15.*mu.*y.^2.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L6.*((3.*mu.*z)./r2.^5 - (3.*z.*(mu - 1))./r1.^5 - (15.*mu.*y.^2.*z)./r2.^7 + (15.*y.^2.*z.*(mu - 1))./r1.^7) - L5.*((15.*y.^3.*(mu - 1))./r1.^7 + (9.*mu.*y)./r2.^5 - (9.*y.*(mu - 1))./r1.^5 - (15.*mu.*y.^3)./r2.^7),                                                                                                                           - L4.*((15.*y.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) - (15.*mu.*y.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L6.*((3.*mu.*y)./r2.^5 - (3.*y.*(mu - 1))./r1.^5 - (15.*mu.*y.*z.^2)./r2.^7 + (15.*y.*z.^2.*(mu - 1))./r1.^7) - L5.*((3.*mu.*z)./r2.^5 - (3.*z.*(mu - 1))./r1.^5 - (15.*mu.*y.^2.*z)./r2.^7 + (15.*y.^2.*z.*(mu - 1))./r1.^7),  0, 0, 0,  0,  0,  0,                                                                                       (3.*y.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*y.*(2.*mu + 2.*x - 2))./(2.*r2.^5), mu./r2.^3 - (mu - 1)./r1.^3 + (3.*y.^2.*(mu - 1))./r1.^5 - (3.*mu.*y.^2)./r2.^5 - 1,                                                                                   (3.*y.*z.*(mu - 1))./r1.^5 - (3.*mu.*y.*z)./r2.^5;
                                                                                                                                                                                                                           L6.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (15.*z.^2.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) + (15.*mu.*z.^2.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L4.*((3.*mu.*z)./r2.^5 - (3.*z.*(mu - 1))./r1.^5 + (15.*z.*(2.*mu + 2.*x).^2.*(mu - 1))./(4.*r1.^7) - (15.*mu.*z.*(2.*mu + 2.*x - 2).^2)./(4.*r2.^7)) - L5.*((15.*y.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) - (15.*mu.*y.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^7)),                                                                                                                           - L4.*((15.*y.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) - (15.*mu.*y.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L6.*((3.*mu.*y)./r2.^5 - (3.*y.*(mu - 1))./r1.^5 - (15.*mu.*y.*z.^2)./r2.^7 + (15.*y.*z.^2.*(mu - 1))./r1.^7) - L5.*((3.*mu.*z)./r2.^5 - (3.*z.*(mu - 1))./r1.^5 - (15.*mu.*y.^2.*z)./r2.^7 + (15.*y.^2.*z.*(mu - 1))./r1.^7), L4.*((3.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*(2.*mu + 2.*x - 2))./(2.*r2.^5) - (15.*z.^2.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^7) + (15.*mu.*z.^2.*(2.*mu + 2.*x - 2))./(2.*r2.^7)) - L5.*((3.*mu.*y)./r2.^5 - (3.*y.*(mu - 1))./r1.^5 - (15.*mu.*y.*z.^2)./r2.^7 + (15.*y.*z.^2.*(mu - 1))./r1.^7) - L6.*((15.*z.^3.*(mu - 1))./r1.^7 + (9.*mu.*z)./r2.^5 - (9.*z.*(mu - 1))./r1.^5 - (15.*mu.*z.^3)./r2.^7),  0, 0, 0,  0,  0,  0,                                                                                       (3.*z.*(2.*mu + 2.*x).*(mu - 1))./(2.*r1.^5) - (3.*mu.*z.*(2.*mu + 2.*x - 2))./(2.*r2.^5),                                                                                       (3.*y.*z.*(mu - 1))./r1.^5 - (3.*mu.*y.*z)./r2.^5, mu./r2.^3 - (mu - 1)./r1.^3 + (3.*z.^2.*(mu - 1))./r1.^5 - (3.*mu.*z.^2)./r2.^5;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,  0, 0, 0, -1,  0,  0,                                                                                                                                                                                                                       0,                                                                                                                                                                                     2,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,  0, 0, 0,  0, -1,  0,                                                                                                                                                                                                                      -2,                                                                                                                                                                                     0,                                                                                                                                                                                 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,  0, 0, 0,  0,  0, -1,                                                                                                                                                                                                                       0,                                                                                                                                                                                     0,                                                                                                                                                                                 0;];
																																																																																																																																																																																																																								  
																																																																																																																																																																																																																								  
        
    end

end